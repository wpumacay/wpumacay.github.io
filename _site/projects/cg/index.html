<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset='utf-8'>
    <meta http-equiv="X-UA-Compatible" content="chrome=1">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" href="/assets/css/style.css?v=">
<!-- Begin Jekyll SEO tag v2.4.0 -->
<title>Gregor, The Coding Cat | A personal blog about CS stuff</title>
<meta name="generator" content="Jekyll v3.7.3" />
<meta property="og:title" content="Gregor, The Coding Cat" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="A personal blog about CS stuff" />
<meta property="og:description" content="A personal blog about CS stuff" />
<link rel="canonical" href="http://localhost:4000/projects/cg/" />
<meta property="og:url" content="http://localhost:4000/projects/cg/" />
<meta property="og:site_name" content="Gregor, The Coding Cat" />
<script type="application/ld+json">
{"description":"A personal blog about CS stuff","@type":"WebPage","url":"http://localhost:4000/projects/cg/","headline":"Gregor, The Coding Cat","@context":"http://schema.org"}</script>
<!-- End Jekyll SEO tag -->

  </head>

  <body>

    <header>

      <div class="container">

        <h1>Gregor, The Coding Cat</h1>
        <h2>Projects</h2>

      </div>
      
    </header>


    <div class="container">
      <section id="main_content">
        <h1 id="design-and-implementation-of-a-simulation-engine-for-locomotion-research">Design and implementation of a simulation engine for locomotion research</h1>

<!-- ![Intro](http://localhost:4000/assets/images/projects/img_cg_scene_entities.png) -->

<iframe width="560" height="315" src="https://www.youtube.com/embed/PjCnE6suZME" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen=""></iframe>

<h2 id="slides"><a href="https://docs.google.com/presentation/d/1wKyg93QdSV0P1rhHNrzce4k-tN6eSdjNL9-i4KI2lxI/edit?usp=sharing">Slides</a></h2>

<h2 id="code"><a href="https://github.com/wpumacay/computer_graphics_finalproject">Code</a></h2>

<h2 id="intro">Intro</h2>

<p>This project focuses in the implementation from the ground-up of a simulation engine, based on the work done by <a href="https://www.cs.ubc.ca/~van/">Michiel van de Panne</a> and its group at the University of British Columbia; in specific, the project <a href="https://xbpeng.github.io/projects/DeepTerrainRL/index.html"><strong>Terrain-Adaptive Locomotion Skills Using Deep Reinforcement Learning</strong></a>, by <a href="https://xbpeng.github.io/">Xue Bin Peng</a>.</p>

<h2 id="objectives">Objectives</h2>

<p>We designed the architecture of the modules to be used for this simulator with the aim to reproduce the results of the project mentioned before, as well as use the resulting engine for some other research purposes.</p>

<p>We have two main goals in this project :</p>

<ul>
  <li>Make a rendering engine to visualize the simulation, and reuse it in other projects.</li>
  <li>Make a physics wrapper of the Bullet3 physics engine to handle physics simulations.</li>
</ul>

<h2 id="about-the-reference-project">About the reference project</h2>

<p>As described earlier, we based our project on the <strong>Terrain-Adaptive Locomotion Skill Using Deep Reinforcement Learning</strong>. This paper focuses on training controllers using Deep Reinforcement Learning in order to achieve locomotion for simulated characters. The project consists of a simulation engine built by the authors, which they used in several projects related to locomotion, like <a href="https://xbpeng.github.io/projects/TerrainRL/index.html">this</a>, <a href="https://xbpeng.github.io/projects/TerrainRL/index.html">this</a>, and more recently <a href="https://xbpeng.github.io/projects/ActionSpace/index.html">this</a>.</p>

<p>Below you can see the demo provided by the authors.</p>

<p><img src="http://localhost:4000/assets/images/projects/gif_reference_project.gif" alt="ReferenceProject" /></p>

<h2 id="design-architecture">Design Architecture</h2>

<p>There are three main modules implemented for this project, which are :</p>

<ul>
  <li><strong>Graphics Engine</strong> : To render the simulated scene.</li>
  <li><strong>Physics wrapper</strong> : To interface with the Bullet3 physics engine.</li>
  <li><strong>Controller wrapper</strong> : To interface with the project’s controllers code.</li>
</ul>

<p><img src="http://localhost:4000/assets/images/projects/img_cg_architecture.png" alt="Img_architecture" /></p>

<h3 id="graphics-engine">Graphics Engine</h3>

<p>A graphics engine is needed to render the simulated scene. The original project uses the old OpenGL’s rendering pipeline in a inmediate render mode, by means of glBegin and glEnd.</p>

<p>We implemented a basic rendering engine to handle the rendering process using the modern OpenGL pipeline ( OpenGL 3 and GLSL 330 core ).</p>

<p>In this stage we had to abstract the functionality of the OpenGL pipeline to be able to use it easily, as well as implementing some necessary visual features like lighting, shadows, debug drawings, etc.</p>

<h3 id="physics-wrapper">Physics wrapper</h3>

<p>The authors used the <a href="http://bulletphysics.org/wordpress/">Bullet3</a> physics engine, which is a popular engine used for collision detection.</p>

<p>We implemented a simple wrapper on top of Bullet to integrate it with the rendering engine. This is achieved by means of an Entity - Component architecture that allows us to integrate different components into the whole architecture.</p>

<h3 id="controller-wrapper">Controller Wrapper</h3>

<p>This last module is in charge of integrating the code from the authors, which handles the torques calculation done by controllers, torques that are input to the joints of the simulated character.</p>

<p>The main work of the authors in this paper was the implementation of these controllers, which are various modules on top of <a href="http://caffe.berkeleyvision.org/">Caffe</a> that take some features from the simulation and calculate the necessary torques for appropiate locomotion.</p>

<h3 id="overall-design">Overall design</h3>

<p>The whole system and its features are depicted in the following figure.</p>

<p><img src="http://localhost:4000/assets/images/projects/img_cg_architecture_features.png" alt="Img_architecture_features" /></p>

<h2 id="implementation">Implementation</h2>

<h3 id="rendering-engine">Rendering Engine</h3>

<p>We implemented some basic features for the rendering engine, which are :</p>

<ul>
  <li>
    <p>Abstracting OpenGL’s functionality : Abstracted some funcionality like VBOs, VAOs, FBOs, materials, etc. into reusable parts in the engine.</p>
  </li>
  <li>
    <p>Basic Lighting : Implemented Phong Shading and added support for multiple types of lights, like directional, spotlight and pointlight. The final simulator uses only directional lights as we are working on implementing deferred rendering for multiple shadow-enabled lights.</p>
  </li>
  <li>
    <p>Shadows : We implemented shadow mapping to give the scene some more realism.</p>
  </li>
</ul>

<p><img src="http://localhost:4000/assets/images/projects/img_cg_rendering_engine_basic_features.png" alt="Img_basic_features" /></p>
<center><b><i>Basic Rendering Features</i></b></center>

<ul>
  <li>Cameras : We implemented some basic cameras to use in the simulation.
<img src="http://localhost:4000/assets/images/projects/gif_cg_cameras.gif" alt="Gif_basic_features" /></li>
</ul>
<center><b><i>Testing cameras</i></b></center>

<ul>
  <li>
    <p>Debug drawings : We implemented a debug drawing system that uses batch rendering to draw various primitives, like lines, boxes, arrows, frustums, etc.</p>
  </li>
  <li>
    <p>UI system : We also implemented a wrapper on top of the <a href="https://github.com/ocornut/imgui">Dear-ImGui</a> library to make some UIs, which helps us for testing more quickly some functionality. Currently, we have abstracted the most basic widgets, and plan to wrap around some extra functionality that the library provides, like plotting time series.</p>
  </li>
</ul>

<p><img src="http://localhost:4000/assets/images/projects/img_cg_rendering_engine_tools.png" alt="Img_basic_features" /></p>
<center><b><i>UI and Debug draws</i></b></center>

<h3 id="wrapper-around-the-physics-engine">Wrapper around the Physics Engine</h3>

<p>The Physics Engine works mostly with primitives that are simulated freely, or attached to each other by joints. We abstracted the necessary functionality and integrate it with the rendering engine.</p>

<p><img src="http://localhost:4000/assets/images/projects/gif_cg_primitives.gif" alt="Gif_primitives_physics" /></p>
<center><b><i>Bullet Collision shapes</i></b></center>

<p><img src="http://localhost:4000/assets/images/projects/gif_cg_joints.gif" alt="Gif_primitives_joints" /></p>
<center><b><i>Bullet Joints</i></b></center>

<h3 id="entity-component-system">Entity Component System</h3>

<p>We implemented an Entity Component system in order to integrate the different components more easily. The basic idea is depicted in the following picture.</p>

<p><img src="http://localhost:4000/assets/images/projects/img_cg_entity_component_system.png" alt="Img_entity_component_system" /></p>
<center><b><i>Entity-component overview</i></b></center>

<p>Basically, an entity will be like a container for other objects that will handle some of its data ( Components ). The entity will serve as the bridge between the components, connecting parts like the physics transforms return from the physics engine, to the graphics components that are in charge of the rendering part, or hold the rendering information of the entity.</p>

<h3 id="terrain-generation">Terrain Generation</h3>

<p>The terrain generation is also key in the simulator. We implemented a basic terrain generator for the simulator which works similarly to the terrain generator in the reference project.</p>

<p>We generate the terrain in a given direction, and make parts appear as they fit into the camera frustums. The terrain is integrated with the physics engine, supporting for now terrain generated by compounds of primitives.</p>

<p>We are working on integrating the more general Heightfield collision shape of Bullet in order to have more general scenarios.</p>

<p><img src="http://localhost:4000/assets/images/projects/gif_cg_terrain.gif" alt="Gif_entity_component_system" /></p>
<center><b><i>Terrain Generation</i></b></center>

<h3 id="motion-and-controllers">Motion and controllers</h3>

<p>The structure of the simulated character can be described by a tree. This structure is stored in a <a href="https://github.com/wpumacay/computer_graphics_finalproject/blob/master/res/deepTerrainData/characters/raptor.json"><strong>json</strong></a> file, which describes the joints as well as the bodies definitions to create the simulated character.</p>

<p>We made a parser for these type of structures ( we changed the <a href="https://github.com/open-source-parsers/jsoncpp">jsoncpp</a> for <a href="https://github.com/nlohmann/json">Json for Modern C++</a> for integration issues ) and a tree with this data stored in each node.</p>

<p><img src="http://localhost:4000/assets/images/projects/img_cg_character_tree.png" alt="Img_character_tree" /></p>
<center><b><i>Character Tree</i></b></center>

<p>We then make the motion and physics components that these character should have. The motion component allows us to test the tree structure of the character, by allowing us to play a sequence of poses into the character.</p>

<p><img src="http://localhost:4000/assets/images/projects/gif_cg_character_motion.gif" alt="Gif_character_motion" /></p>
<center><b><i>Character Motion</i></b></center>

<p><img src="http://localhost:4000/assets/images/projects/gif_cg_character_ragdoll.gif" alt="Gif_character_ragdoll" /></p>
<center><b><i>Character Ragdoll</i></b></center>

<p>We are working on fixing some issues with joints positions and the world scale, as you can see in the offset that the bodies have.</p>

<h3 id="remaining-integration">Remaining integration</h3>

<p>As described in earlier sections, the remaining part of the integration is related to terrain generation ( using heightfield collision shapes ) and integration with the authors’ controllers. The later is the most tricky as there are several modules that have to be understood and integrated. We have the character entity that can receive the torques, so, this would be the missing part to make the character walk as described in the paper. We hope to integrate this part soon in next iterations of the project.</p>

      </section>
    </div>

  </body>
</html>
